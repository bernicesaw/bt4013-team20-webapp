{% extends 'base.html' %} 
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %} 

{% block extra_head %}
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
    /* ... (your existing page layout styles) ... */
    main.container-fluid {
        padding-top: 1rem;
        padding-bottom: 1rem;
    }
    #graph-container-wrapper {
        /* Made container longer by reducing the subtracted value */
        min-height: calc(100vh - 150px); 
        height: 100%;
        width: 100%;
        background-color: #ffffff;
    }
    .jobs-panel-scroll {
        max-height: calc(100vh - 120px); 
        overflow-y: auto;
        padding-right: 0.5rem;
    }
    .job-header {
        cursor: pointer;
        padding: 0.75rem 1rem;
        border-radius: 0.25rem;
        margin-bottom: 0.5rem;
        transition: background-color 0.2s ease;
        border: 1px solid #e9ecef;
        background-color: #f8f9fa;
    }
    .job-header:hover {
        background-color: #e2e6ea;
    }
    .job-rank {
        display: inline-block;
        min-width: 1.5rem;
        text-align: center;
        font-weight: bold;
        color: var(--app-purple);
    }

    /* 2. D3 styles for the Egonet */
    .d3-link {
        stroke-opacity: 0.8;
        stroke-width: 2.5px;
    }

    /* Style for the central "Ego" node */
    .d3-node-ego circle {
        stroke: #fff;
        stroke-width: 2px;
        fill: var(--app-purple, #6f42c1);
    }

    /* Style for all the "transition" job nodes */
    .d3-node-transition circle {
        stroke: #fff;
        stroke-width: 1.5px;
        fill: #17a2b8; /* Bootstrap 'info' blue */
    }

    .d3-node-label {
        font-size: 11px;
        font-weight: 600;
        fill: #343a40;
        pointer-events: none;
        text-anchor: middle;
    }
    
    .d3-node-label.ego-label {
        font-size: 14px;
        fill: var(--app-purple, #6f42c1);
    }

    /* 3. NEW Legend Styles */
    #graph-legend {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 0.75rem;
        border-radius: 0.375rem; /* 6px */
        border: 1px solid #e9ecef;
        box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        font-size: 12px;
        display: none; /* Will be shown by JS */
    }
    #legend-svg {
        display: block;
    }
    .legend-label {
        font-size: 11px;
        font-weight: 600;
        fill: #555;
    }

    /* 4. UPDATED Course Carousel Styles */
    .job-header-purple {
        background-color: var(--app-purple, #6f42c1);
        border-radius: 8px;
        width: fit-content;
        max-width: 100%;
    }

    .job-header-purple h6 {
        font-size: 0.95rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .course-carousel-container {
        position: relative;
        overflow: hidden;
        padding: 15px 0;
    }

    .course-carousel-track {
        display: flex;
        transition: transform 0.5s ease;
        gap: 15px;
    }

    .course-card {
        flex: 0 0 calc(33.333% - 10px);
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #e9ecef;
        min-width: 0; /* Allow flex shrinking */
    }

    .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .course-image {
        width: 100%;
        height: 140px; /* Reduced height */
        object-fit: cover;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .course-content {
        padding: 15px;
    }

    .course-title {
        font-size: 1rem;
        margin-bottom: 8px;
        color: #2c3e50;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .course-description {
        color: #666;
        margin-bottom: 12px;
        line-height: 1.5;
        font-size: 0.85rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 3.9em; /* Consistent height for descriptions */
    }

    .course-meta {
        display: flex;
        justify-content: space-between;
        color: #7f8c8d;
        font-size: 0.8rem;
        margin-bottom: 12px;
        flex-wrap: wrap;
        gap: 5px;
    }

    .course-button {
        display: inline-block;
        background: var(--app-purple, #6f42c1);
        color: white;
        padding: 6px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: background 0.3s ease;
        border: none;
        cursor: pointer;
        text-align: center;
        width: 100%;
    }

    .course-button:hover {
        background: #5a32a3;
        color: white;
        text-decoration: none;
    }

    .carousel-nav {
        display: flex;
        justify-content: center;
        margin-top: 15px;
    }

    .carousel-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #bdc3c7;
        margin: 0 4px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .carousel-dot.active {
        background: var(--app-purple, #6f42c1);
    }

    .carousel-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid #e9ecef;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        font-size: 1rem;
        color: var(--app-purple, #6f42c1);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        z-index: 10;
    }

    .carousel-arrow:hover {
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .carousel-arrow.prev {
        left: 5px;
    }

    .carousel-arrow.next {
        right: 5px;
    }

    .job-courses-section:last-child {
        margin-bottom: 0;
    }

    /* Separator between job sections */
    .job-courses-section + hr {
        margin: 2rem 0;
        border-color: #e9ecef;
        opacity: 0.6;
    }

    @media (max-width: 992px) {
        .course-card {
            flex: 0 0 calc(50% - 8px);
        }
    }

    @media (max-width: 768px) {
        .course-card {
            flex: 0 0 calc(100% - 8px);
        }
        
        .carousel-arrow {
            width: 30px;
            height: 30px;
            font-size: 0.9rem;
        }
        
        .job-header-purple {
            width: 100%;
        }
        
        .job-header-purple h6 {
            white-space: normal;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4 text-app-purple fw-light">{{ page_title }}</h1>

<div class="row">
    
    <div class="col-lg-9 mb-4">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center">
                <h5 class="mb-0 text-muted">Job Transition Network</h5>
                </div>
            <div class="card-body p-1">
                <div id="graph-container-wrapper" style="position: relative;">
                    <div id="graph-container" class="h-100 w-100 d-flex justify-content-center align-items-center">
                        <p class="text-muted text-center m-0 p-5 lead">
                            {{ intro_message|default:"Your job transition network will appear here." }}
                        </p>
                    </div>
                    
                    <div id="graph-legend">
                        <h6 class="mb-1 small fw-bold text-muted">Transition Difficulty</h6>
                        <svg id="legend-svg" width="150" height="30"></svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 mb-4">
        <div class="card shadow-sm border-0 sticky-top" style="top: 1.5rem;">
            <div class="card-header border-bottom py-3">
                <h6 class="mb-0 fw-bold" style="color: var(--app-purple);">All Jobs</h6>
            </div>
            
            <div class="card-body jobs-panel-scroll p-3">
                
                <div class="accordion accordion-flush" id="recommendedJobsAccordion">
                    
                    {% for job in recommended_jobs %}
                    <div class="accordion-item border-0 bg-transparent mb-2">
                        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                            <div class="job-header collapsed" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#collapse{{ forloop.counter }}" 
                                aria-expanded="false" 
                                aria-controls="collapse{{ forloop.counter }}">
                                <span class="job-rank">{{ forloop.counter }}.</span>
                                <strong class="ms-2">{{ job.name }}</strong>
                            </div>
                        </h2>
                        
                        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#recommendedJobsAccordion">
                            <div class="accordion-body p-3 pt-1 border-start border-end border-bottom" style="border-color: #e9ecef !important; background-color: #ffffff;">
    
                                <h6 class="small text-dark mb-2 fw-bold">Details</h6>
                                <p class="small text-muted mb-1">
                                    <strong>Avg. Experience:</strong> 
                                    {{ job.work_exp }} years
                                </p>
                                <p class="small text-muted mb-3">
                                    <strong>Avg. Compensation:</strong> 
                                    ${{ job.yearly_comp|intcomma }}
                                </p>
                            
                                <h6 class="small text-dark mb-2 fw-bold">Top Skills</h6>
                                <div class="d-flex flex-wrap">
                                    {% for skill in job.skills %}
                                        <span class="badge rounded-pill text-bg-light border me-1 mb-1 fw-normal text-wrap">{{ skill }}</span>
                                    {% empty %}
                                        <span classs="small text-muted">No specific skills listed.</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                        <p class="text-muted text-center small p-3">No recommended jobs found.</p>
                    {% endfor %}

                </div>
            </div>
        </div>
    </div>
</div>

<!-- ====================================================== -->
<!-- NEW SECTION: Top Easiest Transitions (full-width row) -->
<!-- ====================================================== -->
<div class="row">
    <div class="col-12 mb-4">
        <div class="card shadow-sm border-0">
        <div class="card-header border-bottom py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-muted">Top Easiest Transitions</h5>
        </div>

        <div class="card-body p-4">
            {% if top_easiest_transitions and top_easiest_transitions|length %}
            <div class="list-group">
                {% for r in top_easiest_transitions %}
                <div class="list-group-item border-0 border-bottom">
                    <div class="d-flex justify-content-between align-items-start flex-wrap">
                    <div class="me-3">
                        <h6 class="fw-bold mb-1 text-dark">{{ r.title }}</h6>
                        <p class="small text-muted mb-1">
                        Needs {{ r.missing_count }} new {{ r.missing_count|pluralize:"skill,skills" }}
                        {% if r.missing_count %} ({{ r.missing|join:", " }}){% endif %}
                        </p>
                        <p class="small text-muted mb-0">
                        Overlap {{ r.overlap_count }}
                        {% if r.overlap_count %} ({{ r.overlap|join:", " }}){% endif %}
                        </p>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-light text-dark border">
                        Ease Score {{ r.ease|floatformat:3 }}
                        </span>
                    </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted mb-0">No easy transitions yet — update your skills to see suggestions.</p>
            {% endif %}
        </div>
        </div>
    </div>
</div>

<!-- ============================================== -->
<!-- NEW: Courses Carousel Section (replaces horizontal scroll) -->
<!-- ============================================== -->
<div class="row courses-section">
    <div class="col-12 mb-4">
        <div class="card shadow-sm border-0">
            <div class="card-header border-bottom py-3 d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold text-muted">Courses for Your Top Transitions</h5>

                {# ---- DEBUG SUMMARY (toggle with ?debug=1) ---- #}
                {% if request.GET.debug == '1' %}
                <span class="small text-muted">
                    [DEBUG] bundles={{ course_recommendations|length|default:0 }}
                </span>
                {% endif %}
            </div>

            <div class="card-body p-4">
                {% if course_recommendations %}
                    {% for bundle in course_recommendations %}
                    <!-- Separate row for each job's courses -->
                    <div class="job-courses-section mb-5">
                        <!-- Job header with purple background -->
                        <div class="job-header-purple mb-3">
                            <h6 class="mb-0 fw-bold text-white px-3 py-2">{{ bundle.job_title }}</h6>
                        </div>
                        
                        {% if bundle.courses %}
                            <div class="course-carousel-container">
                                <button class="carousel-arrow prev">&#10094;</button>
                                <button class="carousel-arrow next">&#10095;</button>
                                
                                <div class="course-carousel-track" data-job="{{ bundle.job_title }}">
                                    {% for c in bundle.courses %}
                                    <div class="course-card">
                                        <div class="course-image"></div>
                                        <div class="course-content">
                                            <h6 class="course-title">
                                                <a href="{{ c.url }}" target="_blank" class="text-decoration-none text-dark">
                                                    {{ c.title }}
                                                </a>
                                            </h6>
                                            <p class="course-description">
                                                {{ c.description|default:"No description available." }}
                                            </p>
                                            <div class="course-meta">
                                                <span>{{ c.provider }}</span>
                                                <span>Similarity: {{ c.sim|floatformat:3 }}</span>
                                            </div>
                                            <a href="{{ c.url }}" target="_blank" class="course-button w-100 text-center">
                                                View Course
                                            </a>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <div class="carousel-nav">
                                    <!-- Dots will be generated by JavaScript -->
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted mb-0 small">No courses available for this transition.</p>
                        {% endif %}
                    </div>
                    
                    <!-- Add separator between job sections (except last one) -->
                    {% if not forloop.last %}
                    <hr class="my-4">
                    {% endif %}
                    
                    {% endfor %}
                {% else %}
                <p class="text-muted mb-0">No course recommendations yet.</p>

                {# ---- DEBUG when empty (toggle) ---- #}
                {% if request.GET.debug == '1' %}
                    <div class="small text-muted mt-2">
                    [DEBUG] course_recommendations is empty —
                    check that the view sets <code>context['course_recommendations']</code>
                    and that each bundle has a non-empty <code>courses</code> list.
                    </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

{{ recommended_jobs|json_script:"jobs-data" }}
{{ graph_data|json_script:"graph-data" }}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // A. Get the graph data element
        const graphDataElement = document.getElementById('graph-data');
        
        // Check if the element exists and has content.
        if (!graphDataElement || !graphDataElement.textContent) {
            console.error('D3 Error: The "graph-data" element was not found or is empty.');
            console.log('This usually means the "graph_data" variable from the view was empty or null.');
            return; // Stop the script
        }
        
        // Now it's safe to parse the content
        const graphData = JSON.parse(graphDataElement.textContent);

        // B. Handle the case where no data is available
        if (!graphData || !graphData.transitions || graphData.transitions.length === 0) {
            console.log('No graph data found. D3 egonet will not be rendered.');
            return; 
        }

        // C. Process the data into D3-readable nodes and links
        const nodes = [];
        const links = [];
        
        // 1. Create the central "Ego" node
        const egoNodeId = graphData.ego_node || "My Role";
        const egoNode = { id: egoNodeId, type: 'ego' };
        nodes.push(egoNode);

        // 2. Create transition nodes and links
        graphData.transitions.forEach(job => {
            nodes.push({ id: job.transition_job, type: 'transition' });
            links.push({ 
                source: egoNode.id, 
                target: job.transition_job, 
                weight: job.transition_weight 
            });
        });

        // D. Create the color scale based on weight
        const weights = links.map(d => d.weight);
        const minWeight = Math.min(...weights);
        const maxWeight = Math.max(...weights);
        
        // --- 1. CHANGED: Reversed the color range ---
        // Now minWeight (easier) = Light Gray, maxWeight (harder) = Dark Purple
        const colorScale = d3.scaleLinear()
            .domain([minWeight, maxWeight])
            .range(["#e0e0e0", "#6f42c1"]); // Light Gray to Dark Purple

        // E. Set up the D3 container and SVG
        const container = document.getElementById('graph-container');
        container.innerHTML = ''; // Clear the placeholder text

        // --- NEW ---
        // Now that we're drawing the graph, also draw the legend.
        (function drawLegend() {
            // Show the legend container
            document.getElementById('graph-legend').style.display = 'block';

            const legendSvg = d3.select("#legend-svg");
            const width = +legendSvg.attr("width");
            const height = +legendSvg.attr("height");
            
            // Create a gradient definition
            const defs = legendSvg.append("defs");
            const linearGradient = defs.append("linearGradient")
                .attr("id", "legend-gradient")
                .attr("x1", "0%")
                .attr("y1", "0%")
                .attr("x2", "100%")
                .attr("y2", "0%");

            linearGradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", colorScale(minWeight)); // Light color (min weight)

            linearGradient.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", colorScale(maxWeight)); // Dark color (max weight)

            // Draw the gradient bar
            legendSvg.append("rect")
                .attr("x", 0)
                .attr("y", 10) // Give space for top label
                .attr("width", width)
                .attr("height", 15)
                .style("fill", "url(#legend-gradient)");

            // --- 2. CHANGED: Update Min label text ---
            legendSvg.append("text")
                .attr("class", "legend-label")
                .attr("x", 0)
                .attr("y", 8) // Above the bar
                .text('Easier');
            
            // --- 3. CHANGED: Update Max label text ---
            legendSvg.append("text")
                .attr("class", "legend-label")
                .attr("x", width)
                .attr("y", 8) // Above the bar
                .attr("text-anchor", "end")
                .text('Harder');
        })();
        // --- END NEW ---


        const width = container.clientWidth;
        const height = container.clientHeight;

        const svg = d3.select(container).append("svg")
            .attr("viewBox", [0, 0, width, height])
            .attr("width", width)
            .attr("height", height)
            .attr("style", "max-width: 100%; height: auto;");

        // F. Create the simulation
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(200)) 
            .force("charge", d3.forceManyBody().strength(-600)) 
            .force("center", d3.forceCenter(width / 2, height / 2))
            // Add a collision force to prevent nodes/labels from overlapping
            .force("collide", d3.forceCollide().radius(d => d.type === 'ego' ? 70 : 60)) // 70px for ego, 60px for others
            .on("tick", ticked);

        // G. Draw the links (lines)
        const link = svg.append("g")
            .attr("class", "d3-links")
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("class", "d3-link")
            .style("stroke", d => colorScale(d.weight));

        // H. Draw the nodes (circles AND labels)
        // We create a <g> element for each node
        const node = svg.append("g")
            .attr("class", "d3-nodes")
            .selectAll("g")
            .data(nodes)
            .join("g") // <-- This group holds both circle and text
            .attr("class", d => d.type === 'ego' ? 'd3-node-ego' : 'd3-node-transition')
            .call(drag(simulation)); // Enable dragging

        // Add the circle to the node group
        node.append("circle")
            .attr("r", d => d.type === 'ego' ? 20 : 12); // Ego node is bigger

        // Add the tooltip to the node group
        node.append("title")
            .text(d => d.id);
            
        // Add the text label to the node group
        node.append("text")
            .text(d => d.id)
            .attr("class", d => d.type === 'ego' ? 'd3-node-label ego-label' : 'd3-node-label')
            // Position label above the circle (radius + padding)
            .attr("y", d => d.type === 'ego' ? -25 : -18);

        // J. Define the 'ticked' function (updates positions)
        function ticked() {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2",d => d.target.y);

            // We only need to move the group, the label inside it moves automatically
            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
            
        }

        // K. Define drag behavior (reusable)
        function drag(simulation) {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }
            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }
            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }

        // COURSE CAROUSEL FUNCTIONALITY - UPDATED FOR SEPARATE JOB SECTIONS
        const courseContainers = document.querySelectorAll('.course-carousel-container');
        
        courseContainers.forEach(container => {
            const track = container.querySelector('.course-carousel-track');
            const courseCards = track.querySelectorAll('.course-card');
            const prevButton = container.querySelector('.carousel-arrow.prev');
            const nextButton = container.querySelector('.carousel-arrow.next');
            const carouselNav = container.querySelector('.carousel-nav');
            
            let currentIndex = 0;
            const cardWidth = courseCards[0] ? courseCards[0].offsetWidth + 15 : 0; // Including gap
            
            // Calculate how many cards to show based on screen size
            function getCardsPerView() {
                if (window.innerWidth <= 768) return 1;
                if (window.innerWidth <= 992) return 2;
                return 3;
            }
            
            // Create navigation dots
            function createDots() {
                if (!courseCards.length) return;
                
                const cardsPerView = getCardsPerView();
                const totalSlides = Math.ceil(courseCards.length / cardsPerView);
                
                carouselNav.innerHTML = '';
                for (let i = 0; i < totalSlides; i++) {
                    const dot = document.createElement('div');
                    dot.className = `carousel-dot ${i === 0 ? 'active' : ''}`;
                    dot.addEventListener('click', () => {
                        currentIndex = i * cardsPerView;
                        updateCarousel();
                    });
                    carouselNav.appendChild(dot);
                }
            }
            
            // Update carousel position
            function updateCarousel() {
                if (!courseCards.length) return;
                
                const cardsPerView = getCardsPerView();
                const maxIndex = Math.max(0, courseCards.length - cardsPerView);
                
                // Ensure currentIndex is within bounds
                currentIndex = Math.min(currentIndex, maxIndex);
                
                // Move the track
                track.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
                
                // Update dots
                const dots = carouselNav.querySelectorAll('.carousel-dot');
                const activeDotIndex = Math.floor(currentIndex / cardsPerView);
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeDotIndex);
                });
            }
            
            // Next slide
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    const cardsPerView = getCardsPerView();
                    const maxIndex = Math.max(0, courseCards.length - cardsPerView);
                    
                    if (currentIndex < maxIndex) {
                        currentIndex += cardsPerView;
                    } else {
                        currentIndex = 0; // Loop back to start
                    }
                    
                    updateCarousel();
                });
            }
            
            // Previous slide
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    const cardsPerView = getCardsPerView();
                    
                    if (currentIndex > 0) {
                        currentIndex -= cardsPerView;
                    } else {
                        // Loop to the end
                        const maxIndex = Math.max(0, courseCards.length - cardsPerView);
                        currentIndex = maxIndex;
                    }
                    
                    updateCarousel();
                });
            }
            
            // Handle window resize
            function handleResize() {
                createDots();
                updateCarousel();
            }
            
            window.addEventListener('resize', handleResize);
            
            // Initialize carousel
            createDots();
            updateCarousel();
        });
    });
</script>
{% endblock %}